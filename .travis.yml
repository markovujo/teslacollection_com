language: php

php:
  - 5.3

services:
  - mysql 

env:
  - DB=mysql

before_script:
  - sh -c "if [ '$DB' = 'mysql' ]; then mysql -e 'CREATE DATABASE teslacollection_com;'; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then mysql -e 'CREATE DATABASE teslacollection_com_test;'; fi"
  - mysql teslacollection_com < ddl/teslacollection_com.sql;
  - mysql -h 0.0.0.0 -u travis teslacollection_com -e 'show tables;'
  - mysql -h 0.0.0.0 -u travis teslacollection_com_test -e 'show tables;'
  - mkdir -p ./app/tmp/cache/models
  - mkdir -p ./app/tmp/cache/persistent
  - chmod -R 777 ./app/tmp
  - cp app/Config/core_default.php app/Config/core.php
  - cd app
  - composer install
  - cd ..
  - phpenv rehash
  - set +H
  - echo "<?php
    class DATABASE_CONFIG {
    public \$default = array(
      'persistent' => false,
      'host' => '0.0.0.0',
      'login' => 'travis',
      'database' => 'teslacollection_com',
      'prefix' => ''
    );
    public \$test = array(
      'persistent' => false,
      'host' => '0.0.0.0',
      'login' => 'travis',
      'database' => 'teslacollection_com_test',
      'prefix' => ''
    );
    }" > app/Config/database.php

script:
  - app/Console/cake test app AllTests --debug

notifications:
  email: true
